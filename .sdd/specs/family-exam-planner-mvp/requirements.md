# 要件定義書

## フェーズ構成

- Phase 1: MVP（Tech0発表までに必須）
- Phase 2: すえさん案に基づく拡張機能（UX向上・運用性向上）

## 機能概要
受験期の家庭向けに、子どものイベント（学校・塾・模試・本番試験等）と準備タスクを一元管理し、Googleカレンダー予定も重ねて家族ビューで確認できるWebアプリのMVPを定義する。

## ユーザーストーリー
- 保護者として、受験関連の予定と準備タスクを家族で一元管理したい。なぜなら情報が紙・ポータル・カレンダーに散在し漏れや二重予約を防ぎたいから。
- 保護者として、仕事予定（Googleカレンダー）と子どものmustイベントのバッティングを早めに把握したい。なぜなら送迎や付き添いの調整を事前に行う必要があるから。
- 子どもとして、今週の自分の予定とやることを1画面で確認したい。なぜなら何をいつまでに終わらせればよいか自分で把握したいから。

## 機能要件(Phase 1: MVP)
### 要件1: 家族・メンバー管理
- 家族アカウントを作成し、メンバーをロール（parent/child）付きで登録できる。子どもごとに名前・学年など基本情報を保持する。
- 受入基準：
  - [ ] 家族アカウントが作成できること。
  - [ ] 子どもを1人以上登録・一覧表示できること。
  - [ ] メンバーのロールがparent/childで保存・参照できること。

### 要件2: イベント管理とカレンダー表示
- イベントのCRUDを提供し、タイトル/日付/開始・終了時刻/種別(school, cram, lesson, exam, other)/重要度(must, should, optional)/参加者/場所/メモを保持する。家族全体の週・月ビューを表示し、子ども・種別でフィルタできる。
- 受入基準：
  - [ ] イベントを作成・編集・削除・一覧表示できること。
  - [ ] 週表示・月表示が切り替えられること。
  - [ ] 子ども別および種別フィルタで表示を絞り込めること。

### 要件3: 準備タスク管理（イベント紐づけ）
- 各イベントに準備タスクを紐づけ、タイトル/期限/ステータス(not_started, in_progress, done)/担当者(parent/child)を管理する。タスクはユーザーが手動で追加する。
- 受入基準：
  - [ ] イベントに対して複数のタスクを追加・編集・削除できること。
  - [ ] ステータスが3段階で更新できること。
  - [ ] 担当者をfamilyメンバーから選択して保存できること。

### 要件4: 子ども別「今週の予定・タスク」ビュー
- 特定の子どもに紐づくイベントとタスクを「今週」範囲でまとめて表示するビューを提供する。
- 受入基準：
  - [ ] 子どもを指定すると、その子の今週のイベント一覧が表示されること。
  - [ ] 同じ画面でその子のタスクをステータス別に表示できること。

### 要件5: Googleカレンダー読み取り・重ね合わせ
- 家族1つのGoogleアカウントを接続し、指定期間の予定を読み取り、家族カレンダーに外部イベントとして重ねて表示する（読み取り専用）。
- 受入基準：
  - [ ] OAuth連携によりGoogle予定を取得できること（作成・更新は行わない）。
  - [ ] 外部イベントがアプリ内イベントと区別できる表示になること。
  - [ ] 接続解除または再取得が行えること。

### 要件6: コンフリクト検知（mustイベントの時間重複）
- 重要度mustのイベント同士が同一子ども（必要なら保護者）で時間重複する場合に検知し、カレンダー上で警告表示する。
- 受入基準：
  - [ ] 同一時間帯で重複するmustイベントを検知できること。
  - [ ] 重複イベントが警告表示（例: 赤枠/アイコン）されること。

### 要件7: イベントメモ・ジャーナル
- 各イベントにテキストメモを複数追加できる。プレーンテキストのみ、画像やリッチテキストは対象外。
- 受入基準：
  - [ ] メモを追加・編集・削除できること。
  - [ ] メモがイベントに紐づいて表示されること。

## 機能要件（Phase 2: すえさん案ベースの拡張）

### 要件P2-1: 受験テンプレートによるタスク自動生成

- イベント種別（模試／本番試験／説明会 など）に応じて、あらかじめ用意した「受験テンプレート」から準備タスクを自動生成できるようにする。
- テンプレートは、少なくとも以下を前提とする：
  - 例：模試用テンプレート
    - 「◯日前までに申込」
    - 「◯日前までに受験料支払」
    - 「前日までに受験票印刷」
    - 「当日の持ち物準備」
  - 例：本番試験用テンプレート（A日程/B日程）
    - 「出願〆切」
    - 「受験料支払」
    - 「受験票印刷」
    - 「会場までのルート確認」
    - 「持ち物・服装準備」
- イベント作成時（または編集時）にテンプレートを選択すると、イベントに紐づくタスクがまとめて生成される。
- 自動生成されたタスクは、ユーザーが個別に編集／削除できる。
- 期日はイベント日時に対する相対日付（前日／◯日前など）をもとに自動設定される。

- 受入基準：
  - [ ] 管理者（保護者）が「模試」「本番試験」などのテンプレートを少なくとも数種類登録できること（もしくは初期テンプレートがシステムに用意されていること）。
  - [ ] イベント作成画面でテンプレートを選択すると、そのイベントに複数のタスクが自動生成されること。
  - [ ] 自動生成されたタスクのタイトル／期日／担当者を後から編集できること。
  - [ ] 自動生成されたタスクを削除しても、イベント自体には影響がないこと。
  - [ ] 同じイベントに対してテンプレートを複数回適用した場合の挙動（重複タスクの扱い）が仕様として決まっていること（例：同名タスクは2重生成しない・常に新規追加する など）。

---

### 要件P2-2: 子ども別「週次予定 & タスク」PDF／印刷用ビュー

- 子どもごとに「今週の予定 & タスク」を1枚のレイアウトで確認し、そのまま印刷またはPDFとして出力できるビューを提供する。
- 内容：
  - 対象期間：指定した週（例：月〜日）
  - 上部に「今週のカレンダー（簡易）」、または日付ごとのイベント一覧
  - 下部に「今週のタスク一覧」（ステータス別／期日順など）
- 用途：
  - 子どもが自分の机や冷蔵庫に貼って使える「1週間のやることシート」として機能すること。
- 画面上のレイアウトとPDF出力結果は、基本的に同じ情報が確認できることを優先する（完全なWYSIWYGでなくてもよいが、親子が見て迷わないレベル）。

- 受入基準：
  - [ ] 子どもを1人選択し、「週」を指定して、その子の「今週の予定 & タスク」を1画面で表示できること。
  - [ ] 表示された内容と同等の情報を、PDFまたは印刷用レイアウトとして出力できること（ブラウザの印刷機能＋印刷用スタイルでも可）。
  - [ ] PDF／印刷出力時に、少なくとも A4 縦1枚に収まるレイアウトが用意されていること。
  - [ ] 予定とタスクの区別（区切りや見出し）が印刷物上でも視認できること。

---

### 要件P2-3: メモ・モチベーションログの強化

- Phase 1 の「イベントメモ・ジャーナル」を拡張し、子ども・家族のモチベーションを可視化するための簡易ログ機能を追加する。
- 機能イメージ：
  - タスク完了時に、保護者や家族が「Good Job」「ありがとう」などのスタンプ／リアクションを付けられる。
  - イベントやタスクに紐づいたメモのうち、「良い出来事」「がんばり」をタグ付けして保存できる。
  - 週次の振り返り画面で、
    - 完了したタスク数（子ども別）
    - 付与されたスタンプ数
    - 「今週のひとこと」（自由記述メモ）
    などを簡単に確認できる。
- 目的：
  - 「やるべきこと管理」だけでなく、「頑張りが見える化されることで家族のチーム感が高まる」状態を作る。

- 受入基準：
  - [ ] タスク詳細画面（または一覧）から、完了済みタスクにスタンプ／リアクションを1つ以上追加できること。
  - [ ] 各タスクに付与されたスタンプの種類と数が確認できること（例：アイコン＋カウント）


## 非機能要件
- パフォーマンス：主要画面（週/月カレンダー、子ども別ビュー）の初回表示が3秒以内で完了すること（ローカル/デモ環境目安）。
- セキュリティ：
  - OAuthトークンや認証情報は安全なストア（DBやKey Vault想定）に保存し、平文でクライアントに露出しないこと。
  - 家族アカウント間のデータ分離を行い、他家族のデータが参照できないこと。
