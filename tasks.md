# 進行状況メモ（family-exam-planner）

## 直近の実装履歴（抜粋）
- 2025-12-10: イベント一覧からも詳細モーダルを開けるよう修正（onSelectEvent を接続）。
- 2025-12-10: ウィークビューでタスクも表示し、メンバー名を選択反映するよう修正。
- 2025-12-10: タスク詳細の担当編集をプルダウン（メンバー一覧）に変更し、ステータス文言を日本語（未対応/進行中/完了）に統一。ウィークビューにタスクも表示、イベント/タスクのメンバー表示を選択メンバー名に揃え、イベント一覧の詳細をモーダル編集と連動。
- 2025-12-10: タスク詳細の担当編集をプルダウン選択に変更（メンバー一覧から選択）。
- 2025-12-10: ヘッダーに familyId を表示し、localStorage から読み込むように改善（切替/ログイン文言も切替）。
- 2025-12-10: family新規作成でAPI失敗時にローカルfamilyIdを設定するフォールバックを追加（メッセージ表示付き）。
- 2025-12-10: family新規作成のメンバー入力を可変にし、「メンバーを追加」ボタンで人数を増やせるように改善。
- 2025-12-10: トップUIを Apple HIG 風に刷新し、カードのドラッグ&ドロップ並べ替えを正式採用（元 /mock）。ウィークビューを月曜始まり＋週ナビゲーション付きに拡張。イベント/タスクをクリックすると詳細シートを表示。
- 2025-12-10: イベント/タスク詳細シートを ESC でも閉じられるように改善。
- 2025-12-10: イベント/タスク詳細シートに編集モードを追加（タイトル/日時/場所/タグ/担当/ステータスの編集）。編集中は ESC で閉じないよう制御。
- 2025-12-10: family新規作成時に任意の家族メンバー名を入力できるよう `/auth` にフィールド追加。保存したメンバー名をトップUIに反映（ローカル表示用）。
- 2025-12-10: 詳細シート選択切替を修正（キー付与でイベント/タスクが正しく開き、編集中ESC制御を維持）。
- 2025-12-10: イベント追加フォームをトップに組み込み（familyId 設定時は `/api/events` に POST、ローカル即時反映）。ヘッダーに「新規作成/ログイン」導線を追加し、専用ページ `/auth` を新設（サインアップ/ログイン/Cookie 復元で familyId を保存してトップへリダイレクト）。
- 2025-12-10: `lucide-react` 依存を追加し、モジュール解決エラーを解消。
- 2025-12-09: 週/月カレンダー刷新（Google予定重ね表示、コンフリクト赤枠）、Google連携UX強化、コンフリクト一覧、メンバー/タスクUX改善、テンプレ機能実装、簡易認証/セッション、バリデーション強化。

## 完了した主な対応（2025-12-09 時点まで）
- 週/月カレンダー刷新：Google予定色分け重ね表示、クリック詳細、月曜始まり週ビュー、conflict赤枠表示。
- Google連携UX強化：連携状態/エラー/期限切れバッジ、最終同期・件数表示、再取得・再認可導線追加。状態取得API `/api/google/state` 追加。トークン期限切れ時の自動リフレッシュ/再認可ハンドリング。
- コンフリクト一覧：must イベント同士の衝突リスト。
- メンバー/タスクUX：メンバー編集・削除（削除時は担当タスク未割当）、family 作成 API/UI、フィールド内エラー（メンバー/タスク追加、イベント作成）。
- タスク周辺：担当者選択・期日編集・削除確認、ステータス変更、タスク追加時のエラー表示。
- イベントメモ/ジャーナル：イベントごとのメモ追加/閲覧。
- カレンダー週/月ビューとフィルタ UI、メンバー/家族管理 UI、Google OAuth 開始・状態表示・再認可フローを実装。
- P2-1 テンプレ機能：Template/TemplateTask 追加、イベント作成時にテンプレタスク自動生成、テンプレ一覧/作成/削除 UI と API 実装。シードに模試/本番 A 日程/本番 B 日程テンプレを追加。タグ付け/検索フィルタも実装。
- イベント編集導線：詳細パネルからタイトル/日時/重要度/場所/メモ/参加者を編集し保存、イベント削除も可能。
- Family 認証導線：サインアップ（name/email/password）とログインで familyId を取得し選択可能に。登録・ログイン API 追加。Cookie セッションでの family 選択 UI（/api/auth/me, ログイン/サインアップ時に cookie セット、ログアウト）。
- バリデーション UI 強化：サインアップ/ログインにフィールド内エラーと入力チェック（必須・長さ）を追加。

## これから着手する優先順（例）
1. イベント詳細モーダルの情報充実（メモ/テンプレ由来/Google イベント区別）と編集導線の整理
2. タスク詳細の編集・削除モーダル化、並び替え UI
3. カード配置（DnD）のユーザーごとの永続化（localStorage or サーバー設定）
4. 本格的な認証・セッション管理（JWT/Cookie 強化）と familyId 自動適用
5. コンフリクト検知/一覧の拡張（優先度ソート、対応メモ）
6. 週/月ビューのスワイプ/ショートカット対応、PDF/印刷対応（P2-2）

## メモ
- テスト: `cd web && npm test` 実行済み（vitest OK）。`npm run lint` は随時実行。
- Prisma の package.json 設定は非推奨警告あり（Prisma 7 移行時に対応予定）。
